#
include "http://maddash.calculquebec.ca/MeshConfig/sites-CC.json"
include "http://maddash.calculquebec.ca/MeshConfig/sites-cq.json"
#include "http://maddash.calculquebec.ca/MeshConfig/sites-wg.json"
#include "http://maddash.calculquebec.ca/MeshConfig/sites-co.json"
#include "http://maddash.calculquebec.ca/MeshConfig/sites-acenet.json"

########################################
# Test Spec section
########################################
# Test spec for testing achievable bandwidth once every 4 hours
# Usage: mesh within region
<test_spec bwctl_4h_tcp_test>
  type              perfsonarbuoy/bwctl  # Perform a bwctl test (i.e. achievable bandwidth)
  tool              bwctl/iperf          # Use 'iperf' to do the bandwidh test
  protocol          tcp                  # Run a TCP bandwidth test
  interval          14400                # Run the test every 4 hours
  duration          20                   # Perform a 20 second test
  force_bidirectional   1
</test_spec>

# Define a test spec for doing jitter, loss and latency testing
# Usage: mesh with all Compute Canada PS nodes
<test_spec owamp_10Hz_test>
  type              perfsonarbuoy/owamp  # Perform a constant low-bandwidth OWAMP test
  packet_interval   0.1                 # Send 10 packets every second (i.e. pause 0.1 seconds between each packet)
  loss_threshold    10                   # Wait no more than 10 seconds for a response
  session_count     18000                # Refresh the test every half hour (once every 18000 packets)
  sample_count      300                  # Send results back every 30 seconds (once every 300 packets)
  packet_padding    0                    # The size of the packets (not including the IP/UDP headers)
  bucket_width      0.001                # The granularity of the measurements
  force_bidirectional   1
</test_spec>

# Define a test spec for running traceroute tests every 10 minutes
# Usage: 
<test_spec traceroute_test>
  type              traceroute           # Perform a traceroute test
  test_interval     600                  # Run the test every 5 minutes
  protocol          udp                  # Run a UDP traceroute (could also be 'icmp')
  timeout           30                   # Wait 30 seconds
  pause             0                    # Number of seconds to pause between each traceroute probe
  waittime          5                    # Number of seconds to wait for a response before assuming its lost
  first_ttl         0                    # The initial value for the TTL
  max_ttl           64                   # The maximum value for the TTL
  packet_size       40                   # The size of the packets (not include IP/UDP headers)
</test_spec>

########################################
# Group section
########################################
# There can be one or more 'group' blocks. These contain a list of hosts that will be used in a test (defined later). 
# A group type 'mesh' means that all hosts in the list will test to all other hosts in the list.

# CC_latency_hosts lists all Compute Canada perfSonar latency nodes to build a full mesh latency test.
<group CC_latency_hosts>
  type   mesh
  member lat-ulaval.calculquebec.ca
  member lat-mcgill.calculquebec.ca
  member lat-umontreal.calculquebec.ca
  member lat-udes.ccs.usherbrooke.ca
  member lat-stfx.ace-net.ca
  member lat-mta.ace-net.ca
  member lat-acadiau.ace-net.ca
  member lat-cbu.ace-net.ca
  member lat-uwo.sharcnet.ca
  member lat-uw.sharcnet.ca
  member lat-mac.sharcnet.ca
  member lat-uog.sharcnet.ca
  member lat-utoronto.scinet.utoronto.ca
  member lat.hpcvl.queensu.ca
  member lat-ubc.westgrid.ca
  member lat-ucalgary.westgrid.ca
  member lat-usask.westgrid.ca
  member lat-umanitoba.westgrid.ca
  member lat-sfu.westgrid.ca
  member lat-uvic.westgrid.ca
  member lat-ualberta.westgrid.ca
</group>

# perfSonar bdw nodes participating in full mesh bandwidth tests in CQ
<group CQ_bandwidth_hosts>
  type   mesh
  member bdw-ulaval.calculquebec.ca
  member bdw-mcgill.calculquebec.ca
  member bdw-umontreal.calculquebec.ca
  member bdw-udes.ccs.usherbrooke.ca
</group>

# perfSonar bdw nodes participating in full mesh bandwidth tests in WG
<group WG_bandwidth_hosts>
  type   mesh
  member bdw-ubc.westgrid.ca
  member bdw-ucalgary.westgrid.ca
  member bdw-usask.westgrid.ca
  member bdw-umanitoba.westgrid.ca
  member bdw-sfu.westgrid.ca
  member bdw-uvic.westgrid.ca
  member bdw-ualberta.westgrid.ca
</group>

# perfSonar bdw nodes participating in full mesh bandwidth tests in CO
<group CO_bandwidth_hosts>
  type   mesh
  member lat-uwo.sharcnet.ca
  member lat-uw.sharcnet.ca
  member lat-mac.sharcnet.ca
  member lat-uog.sharcnet.ca
  member lat-utoronto.scinet.utoronto.ca
  member lat.hpcvl.queensu.ca
</group>

# perfSonar bdw nodes participating in full mesh bandwidth tests in AceNet
<group AceNet_bandwidth_hosts>
  type   mesh
  member lat-stfx.ace-net.ca
  member lat-mta.ace-net.ca
  member lat-acadiau.ace-net.ca
  member lat-cbu.ace-net.ca
</group>

# perfSonar bdw nodes participating in bandwidth tests across regions
<group CC_bandwidth_hosts>
  type   mesh
  member
  member
  member
  member
</group>

########################################
# Test section
########################################
# Defines the actual tests that will be configured in the perfSonar nodes
#
# description: Name of the test that will appear under "Scheduled Tests"
# group: Group of perfSonar nodes that should implement this test (defined earlier)
# test_spec: Definition of the test (defined earlier)
<test>
  description       OWAMP Test Between CQ Latency Hosts
  group             CC_latency_hosts
  test_spec         owamp_10Hz_test
</test>

<test>
  description       TCP BWCTL Test Between CQ Bandwidth Hosts
  group             CQ_bandwidth_hosts
  test_spec         bwctl_4h_tcp_test
</test>

<test>
  description       TCP BWCTL Test Between WG Bandwidth Hosts
  group             WG_bandwidth_hosts
  test_spec         bwctl_4h_tcp_test
</test>

<test>
  description       TCP BWCTL Test Between CO Bandwidth Hosts
  group             CO_bandwidth_hosts
  test_spec         bwctl_4h_tcp_test
</test>

<test>
  description       TCP BWCTL Test Between AceNet Bandwidth Hosts
  group             AceNet_bandwidth_hosts
  test_spec         bwctl_4h_tcp_test
</test>
