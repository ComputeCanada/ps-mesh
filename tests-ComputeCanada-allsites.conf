########################################
# Test Spec section
########################################
# Test spec for testing achievable bandwidth once every 4 hours
# Usage: mesh within region
<test_spec bwctl_4h_tcp_test>
  type              perfsonarbuoy/bwctl  # Perform a bwctl test (i.e. achievable bandwidth)
  tool              bwctl/iperf          # Use 'iperf' to do the bandwidh test
  protocol          tcp                  # Run a TCP bandwidth test
  interval          14400                # Run the test every 4 hours
  duration          20                   # Perform a 20 second test
  force_bidirectional   1
</test_spec>

# Usage: mesh across Canada
<test_spec bwctl_Canada_tcp_test>
  type              perfsonarbuoy/bwctl  # Perform a bwctl test (i.e. achievable bandwidth)
  tool              bwctl/iperf          # Use 'iperf' to do the bandwidh test
  protocol          tcp                  # Run a TCP bandwidth test
  interval          43200                # Run the test every 12 hours
  duration          40                   # Perform a 40 second test
  force_bidirectional   1
</test_spec>

# Define a test spec for doing jitter, loss and latency testing
# Usage: mesh with all Compute Canada PS nodes
<test_spec owamp_10Hz_test>
  type              perfsonarbuoy/owamp  # Perform a constant low-bandwidth OWAMP test
  packet_interval   0.1                  # Send 10 packets every second (i.e. pause 0.1 seconds between each packet)
  loss_threshold    10                   # Wait no more than 10 seconds for a response
  session_count     18000                # Refresh the test every half hour (once every 18000 packets)
  sample_count      300                  # Send results back every 30 seconds (once every 300 packets)
  packet_padding    0                    # The size of the packets (not including the IP/UDP headers)
  bucket_width      0.001                # The granularity of the measurements
  force_bidirectional   1
</test_spec>

# Define a test spec for running traceroute tests every 10 minutes
# Usage:
<test_spec traceroute_test>
  type              traceroute           # Perform a traceroute test
  test_interval     600                  # Run the test every 5 minutes
  protocol          udp                  # Run a UDP traceroute (could also be 'icmp')
  timeout           30                   # Wait 30 seconds
  pause             0                    # Number of seconds to pause between each traceroute probe
  waittime          5                    # Number of seconds to wait for a response before assuming its lost
  first_ttl         0                    # The initial value for the TTL
  max_ttl           64                   # The maximum value for the TTL
  packet_size       40                   # The size of the packets (not include IP/UDP headers)
</test_spec>

########################################
# Group section
########################################
# There can be one or more 'group' blocks. These contain a list of hosts that will be used in a test (defined later).
# A group type 'mesh' means that all hosts in the list will test to all other hosts in the list.

# ComputeCanada_latency_hosts lists all Compute Canada perfSonar latency nodes to build a full mesh latency test.
<group ComputeCanada_latency_hosts>
  type   mesh
  # CalculQuebec
  member lat-ulaval.calculquebec.ca
  member lat-mcgill.calculquebec.ca
  member lat-umontreal.calculquebec.ca
  member lat-udes.ccs.usherbrooke.ca

  # WestGrid
  member lat-uvic.westgrid.ca
  member lat-ubc.westgrid.ca
  member lat-sfu.westgrid.ca
  member lat-ucalgary.westgrid.ca
  member lat-ualberta.westgrid.ca
  member lat-usask.westgrid.ca
  member lat-umanitoba.westgrid.ca

  # SHARCNET
  member lat-uwo.sharcnet.ca
  member lat-uw.sharcnet.ca
  member lat-utoronto.scinet.utoronto.ca
  member lat.hpcvl.queensu.ca

  # AceNet
  member lat-acadiau.ace-net.ca

  # CANARIE
  member lat-mtrl2pfs1.canarie.ca
  member lat-hlfx1pfs1.canarie.ca
  member lat-toro1pfs1.canarie.ca
  member sask1pfs2.canarie.ca
  member lat-vncv1pfs1.canarie.ca
  member lat-wnpg1pfs1.canarie.ca
  member otwa3pfs1.canarie.ca
  member lat-clgr2pfs1.canarie.ca

  # BCNET
  member pfs1-lat.klwn1.bc.net

  # Cybera
  member lat-uofa-edm.cybera.ca
  member lat-uofc-cgy.cybera.ca

  # Acorn
  member lat-dal.acorn-ns.ca

  # SRnet
  member lat-sask1pfs1.srnet.ca

  # MRnet
  member 192.139.69.53

  # MERLIN
  member lat-gp-ftn.nbren.ca
</group>

# perfSonar bdw nodes participating in bandwidth tests across regions
#<group ComputeCanada_bandwidth_hosts>
#  type   mesh
#  member bdw-ubc.westgrid.ca
#  member bdw-usask.westgrid.ca
#  member bdw-umanitoba.westgrid.ca
#  member bdw-uw.sharcnet.ca
#  member bdw-utoronto.scinet.utoronto.ca
#  member bdw-ulaval.calculquebec.ca
#  member bdw-acadiau.ace-net.ca
#</group>

########################################
# Test section
########################################
# Defines the actual tests that will be configured in the perfSonar nodes
#
# description: Name of the test that will appear under "Scheduled Tests"
# group: Group of perfSonar nodes that should implement this test (defined earlier)
# test_spec: Definition of the test (defined earlier)
<test>
  description       OWAMP Test Between ComputeCanada Latency Hosts
  group             ComputeCanada_latency_hosts
  test_spec         owamp_10Hz_test
</test>

<test>
  description       BWCTL Test Between ComputeCanada Bandwidth Hosts
  group             ComputeCanada_bandwidth_hosts
  test_spec         bwctl_Canada_tcp_test
</test>
